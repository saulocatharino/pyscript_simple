<!doctype html>
<html lang="pt">
	<head>
		<meta charset="utf-8">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


		<title>PyScript - Executando Aplicações Python no FrontEnd</title>

	</head>


<!--  Este script adiciona a camada para interpretação do Python -->
<script defer src="https://pyscript.net/alpha/pyscript.js"></script>



<!-- Aqui adicionamos as bibliotecas que utilizaremos em nosso projeto para configurar o ambiente virtual -->
<py-env>
- pandas
- numpy
- matplotlib
- seaborn
</py-env>

<body style='padding:10px;'>

<br></br>
<div class="container-fluid"><p class="h1">PyScript</p><h6>Executando Python no FrontEnd</h6></div><br>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<hr></hr>

<div class="content">
	<div class="row align-items-start">
		<div id='btc' class="col">
		<h4>BTC</h4><br>
		</div><br>

		<div id='eth' class="col">
		<h4>ETH</h4><br>
		</div><br>
	</div>
	<br><br>
	<div class="row align-items-start">
		<div id='norm' class="col">
		<h4>COMPARAÇÃO DE DINÂMICA</h4>
		</div>
	</div>
</div>

<!-- Tag para início da aplicação Python -->
<py-script>

import pyodide
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import json
import seaborn as sns
import time

atual = time.time()
sns.set_theme(style="darkgrid")

def get_data(symbol):
	res2 = pyodide.open_url('https://min-api.cryptocompare.com/data/v2/histohour?fsym={}&tsym=USD&limit=1500'.format(symbol))

	J = json.loads(res2.read())

	data = np.array(J['Data']['Data'])
	bids = []
	for d in data:
		bids.append(d['close'])	

	return np.array(bids), data

def run(symbol):
	fig , ax = plt.subplots(1, figsize=(4,3))
	bids, data = get_data(symbol)
	ax.set_title(symbol)
	ax.plot(bids)

	return fig, data
</py-script>

<!-- Direciona a saida do script Python para o elemento com id = 'btc' -->
<py-script output="btc">
	
fig, data = run('BTC')

maxima = data[-1]['high']
minima = data[-1]['low']
print("Mínima em 24h: U${}".format(minima))
print("Máxima em 24h: U${}".format(maxima))
fig
</py-script>

<!-- Direciona a saida do script Python para o elemento com id = 'eth' -->

<py-script output="eth">

fig2, data2 = run('ETH')
maxima2 = data2[-1]['high']
minima2 = data2[-1]['low']
print("Mínima em 24h: U${}".format(minima2))
print("Máxima em 24h: U${}".format(maxima2))
atual = time.time()
fig2

</py-script>


<py-script output="norm">
data_c,_ = get_data('BTC')
data2_c,_ = get_data('ETH')

data_c = data_c / data_c.mean()
data2_c = data2_c / data2_c.mean()

fig, ax = plt.subplots(1)
ax.plot(data_c, label='BTC')
ax.plot(data2_c, label='ETH')
ax.legend()
fig


</body>
</html>
